<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>AdvertReports</title>

<script src="SQLandR_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="SQLandR_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="SQLandR_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="SQLandR_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="SQLandR_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="SQLandR_files/navigation-1.1/tabsets.js"></script>
<link href="SQLandR_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="SQLandR_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">AdvertReports</h1>

</div>


<p>loading the SQLLite db file into R</p>
<pre class="r"><code>library(RSQLite)

filename &lt;- &quot;advert.db&quot;
sqlite.driver &lt;- dbDriver(&quot;SQLite&quot;)
db &lt;- dbConnect(sqlite.driver,
                dbname = filename)</code></pre>
<p>List the tables avalaible in the db</p>
<pre class="r"><code>dbListTables(db)</code></pre>
<pre><code>## [1] &quot;campaigns&quot;</code></pre>
<p>passing the “campaings” db table in a R dataframe named <strong>campaignsinfo</strong> and listing the data</p>
<pre class="r"><code>campaingnsinfo&lt;-dbReadTable(db, &quot;campaigns&quot;)
knitr::kable(campaingnsinfo)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="right">PAYOUT</th>
<th align="left">ACCOUNT_MANAGER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2b7203e1d1b1c3dd4615bdd0ffe60736</td>
<td align="right">10.00</td>
<td align="left">John Smith</td>
</tr>
<tr class="even">
<td align="left">49f0bad299687c62334182178bfd75d8</td>
<td align="right">5.30</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="odd">
<td align="left">adbf5a778175ee757c34d0eba4e932bc</td>
<td align="right">3.10</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="even">
<td align="left">1395ad342f7331f6ae81badb2eeb4717</td>
<td align="right">8.10</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="odd">
<td align="left">db06e8e094e3b4b5943bbb71aabe9cdc</td>
<td align="right">0.90</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="even">
<td align="left">39060730d62be825ebb599711124309a</td>
<td align="right">9.00</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="odd">
<td align="left">bff149a0b87f5b0e00d9dd364e9ddaa0</td>
<td align="right">4.87</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="even">
<td align="left">a8f5f167f44f4964e6c998dee827110c</td>
<td align="right">0.45</td>
<td align="left">John Smith</td>
</tr>
<tr class="odd">
<td align="left">396ac2a33748bb784077f4112335faa0</td>
<td align="right">3.76</td>
<td align="left">John Smith</td>
</tr>
<tr class="even">
<td align="left">a4f0dc8026624beec687c6b74e5adc46</td>
<td align="right">7.00</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="odd">
<td align="left">b5b037a78522671b89a2c1b21d9b80c6</td>
<td align="right">7.60</td>
<td align="left">Erica Archer</td>
</tr>
</tbody>
</table>
<p>df constists of 11 observations of 3 variables(<code>ID</code>,<code>PAYOUT</code>, <code>ACCOUNT_MANAGER</code>) we will change the name of the <code>ID</code> variable to <code>CAMPAiNGID</code> since ID is used also as a variable name in the conversions datasets</p>
<pre class="r"><code>library(dplyr)
campaingnsinfo&lt;-campaingnsinfo%&gt;%rename(CAMPAIGNID=ID)
knitr::kable(head(campaingnsinfo, n=11))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">CAMPAIGNID</th>
<th align="right">PAYOUT</th>
<th align="left">ACCOUNT_MANAGER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2b7203e1d1b1c3dd4615bdd0ffe60736</td>
<td align="right">10.00</td>
<td align="left">John Smith</td>
</tr>
<tr class="even">
<td align="left">49f0bad299687c62334182178bfd75d8</td>
<td align="right">5.30</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="odd">
<td align="left">adbf5a778175ee757c34d0eba4e932bc</td>
<td align="right">3.10</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="even">
<td align="left">1395ad342f7331f6ae81badb2eeb4717</td>
<td align="right">8.10</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="odd">
<td align="left">db06e8e094e3b4b5943bbb71aabe9cdc</td>
<td align="right">0.90</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="even">
<td align="left">39060730d62be825ebb599711124309a</td>
<td align="right">9.00</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="odd">
<td align="left">bff149a0b87f5b0e00d9dd364e9ddaa0</td>
<td align="right">4.87</td>
<td align="left">Felix Butterworth</td>
</tr>
<tr class="even">
<td align="left">a8f5f167f44f4964e6c998dee827110c</td>
<td align="right">0.45</td>
<td align="left">John Smith</td>
</tr>
<tr class="odd">
<td align="left">396ac2a33748bb784077f4112335faa0</td>
<td align="right">3.76</td>
<td align="left">John Smith</td>
</tr>
<tr class="even">
<td align="left">a4f0dc8026624beec687c6b74e5adc46</td>
<td align="right">7.00</td>
<td align="left">Erica Archer</td>
</tr>
<tr class="odd">
<td align="left">b5b037a78522671b89a2c1b21d9b80c6</td>
<td align="right">7.60</td>
<td align="left">Erica Archer</td>
</tr>
</tbody>
</table>
<p>Merging the indivudal csv files containing the conversion events from 01-03-2019 to 07-03-2019 to a dataframe naned <strong>conversionevents</strong></p>
<pre class="r"><code>#change the wd to the folder where conversion files stored
setwd(&quot;/Users/christospsaropoulos/Documents/Git/SQLandR/conversions&quot;)
getwd()</code></pre>
<pre><code>## [1] &quot;/Users/christospsaropoulos/Documents/Git/SQLandR/conversions&quot;</code></pre>
<pre class="r"><code>library(stringr)
library(readr)
library(purrr)
library(dplyr)

#create a list with the names of the csvs that contain the conversion data
files &lt;- list.files( pattern = &quot;csv&quot;, full.names = TRUE)
#merge the individual csv adding a column that contains the file name 
conversionevents&lt;-files %&gt;% 
  map(.f = ~read_csv(.x)) %&gt;%
  set_names(nm = files) %&gt;%     
  map_dfr(identity, .id = &quot;Name&quot;)
#replace the Name column with Date
conversionevents&lt;-conversionevents%&gt;%mutate(Name=str_extract(Name,&quot;[0-9]{4}[-][0-9]{2}[-][0-9]{2}+&quot;))%&gt;%rename(Date=Name)%&gt;%mutate(Date=as.Date(Date))
conversionevents</code></pre>
<pre><code>## # A tibble: 121,878 x 3
##    Date       ID                                CAMPAIGNID                 
##    &lt;date&gt;     &lt;chr&gt;                             &lt;chr&gt;                      
##  1 2019-03-01 5f6e57a887303a5f568459820e87904b… 39060730d62be825ebb5997111…
##  2 2019-03-01 c4c6e95e34c3bfe9d8b9628dfcc8a244… 39060730d62be825ebb5997111…
##  3 2019-03-01 b645996f754e084f5da14be7197d3c1d… b5b037a78522671b89a2c1b21d…
##  4 2019-03-01 e3527595bb5f0c3deef9a2a7a6f7b88e… 39060730d62be825ebb5997111…
##  5 2019-03-01 46b3d889fa4fc90dd56b64f323575110… b5b037a78522671b89a2c1b21d…
##  6 2019-03-01 6bda4fea92cf9310500684a702a7bb06… db06e8e094e3b4b5943bbb71aa…
##  7 2019-03-01 4bbf1c577a6ae45c5fb33ede9b18c8a7… 39060730d62be825ebb5997111…
##  8 2019-03-01 9a1519e497fe9aabe041891f47247dfd… 396ac2a33748bb784077f41123…
##  9 2019-03-01 8e15e2b783986d0054b58fa1e1242e06… 1395ad342f7331f6ae81badb2e…
## 10 2019-03-01 99f8175f367caeb7138fe348a4fa98de… 2b7203e1d1b1c3dd4615bdd0ff…
## # … with 121,868 more rows</code></pre>
<p>Removing duplicates from the <strong>conversionevents</strong> dataframe and saving the unique values in a new dataframe named <strong>conversionevents_unique</strong>. A total of 2389 duplicate values have been removed.</p>
<pre class="r"><code>conversionevents_unique&lt;-distinct(conversionevents)
conversionevents_unique</code></pre>
<pre><code>## # A tibble: 119,489 x 3
##    Date       ID                                CAMPAIGNID                 
##    &lt;date&gt;     &lt;chr&gt;                             &lt;chr&gt;                      
##  1 2019-03-01 5f6e57a887303a5f568459820e87904b… 39060730d62be825ebb5997111…
##  2 2019-03-01 c4c6e95e34c3bfe9d8b9628dfcc8a244… 39060730d62be825ebb5997111…
##  3 2019-03-01 b645996f754e084f5da14be7197d3c1d… b5b037a78522671b89a2c1b21d…
##  4 2019-03-01 e3527595bb5f0c3deef9a2a7a6f7b88e… 39060730d62be825ebb5997111…
##  5 2019-03-01 46b3d889fa4fc90dd56b64f323575110… b5b037a78522671b89a2c1b21d…
##  6 2019-03-01 6bda4fea92cf9310500684a702a7bb06… db06e8e094e3b4b5943bbb71aa…
##  7 2019-03-01 4bbf1c577a6ae45c5fb33ede9b18c8a7… 39060730d62be825ebb5997111…
##  8 2019-03-01 9a1519e497fe9aabe041891f47247dfd… 396ac2a33748bb784077f41123…
##  9 2019-03-01 8e15e2b783986d0054b58fa1e1242e06… 1395ad342f7331f6ae81badb2e…
## 10 2019-03-01 99f8175f367caeb7138fe348a4fa98de… 2b7203e1d1b1c3dd4615bdd0ff…
## # … with 119,479 more rows</code></pre>
<p>Loading the rejected conversions in a R dataframe named <strong>rejections</strong>. As we can see we have 4779 rejected conversions</p>
<pre class="r"><code>rejections &lt;- read.table(&quot;rejections.txt&quot;, header=FALSE, fill = TRUE)
rejections&lt;-rejections%&gt;% mutate_all(as.character)%&gt;%rename(ID=V1)
head(rejections)</code></pre>
<pre><code>##                                         ID
## 1 76e40637d5f6e3f1d06df3c3341745cdfc9041de
## 2 2162a7f5ef30d438e50687502435c3d3ee4e2f34
## 3 944cf89cba90c4ea175bc346ab92c719d72c48c3
## 4 7c6367196670bd1f7a94d0448d6a160f82187de5
## 5 60e9d4db34d97d2e37bc4b233dbf715448294a82
## 6 821ae887ac6626b80eb8d369f956908baf2e4a15</code></pre>
<pre class="r"><code>summary(rejections)</code></pre>
<pre><code>##       ID           
##  Length:4779       
##  Class :character  
##  Mode  :character</code></pre>
<p>excluding <code>ID</code>listed in <strong>rejections</strong> from <strong>conversionsevents_unique</strong></p>
<pre class="r"><code>conversionevents_unique&lt;-conversionevents_unique %&gt;% anti_join(rejections)
conversionevents_unique</code></pre>
<pre><code>## # A tibble: 114,710 x 3
##    Date       ID                                CAMPAIGNID                 
##    &lt;date&gt;     &lt;chr&gt;                             &lt;chr&gt;                      
##  1 2019-03-01 5f6e57a887303a5f568459820e87904b… 39060730d62be825ebb5997111…
##  2 2019-03-01 c4c6e95e34c3bfe9d8b9628dfcc8a244… 39060730d62be825ebb5997111…
##  3 2019-03-01 b645996f754e084f5da14be7197d3c1d… b5b037a78522671b89a2c1b21d…
##  4 2019-03-01 e3527595bb5f0c3deef9a2a7a6f7b88e… 39060730d62be825ebb5997111…
##  5 2019-03-01 6bda4fea92cf9310500684a702a7bb06… db06e8e094e3b4b5943bbb71aa…
##  6 2019-03-01 4bbf1c577a6ae45c5fb33ede9b18c8a7… 39060730d62be825ebb5997111…
##  7 2019-03-01 9a1519e497fe9aabe041891f47247dfd… 396ac2a33748bb784077f41123…
##  8 2019-03-01 8e15e2b783986d0054b58fa1e1242e06… 1395ad342f7331f6ae81badb2e…
##  9 2019-03-01 99f8175f367caeb7138fe348a4fa98de… 2b7203e1d1b1c3dd4615bdd0ff…
## 10 2019-03-01 3a9b8971c8a7294c666485cf6230aab2… b5b037a78522671b89a2c1b21d…
## # … with 114,700 more rows</code></pre>
<p>Grouping conversions per <code>GAMPAINGID</code></p>
<pre class="r"><code>conversionevents_unique %&gt;% group_by(CAMPAIGNID) %&gt;%summarise( campaignconversion = n())</code></pre>
<pre><code>## # A tibble: 11 x 2
##    CAMPAIGNID                       campaignconversion
##    &lt;chr&gt;                                         &lt;int&gt;
##  1 1395ad342f7331f6ae81badb2eeb4717               1912
##  2 2b7203e1d1b1c3dd4615bdd0ffe60736              17598
##  3 39060730d62be825ebb599711124309a              16873
##  4 396ac2a33748bb784077f4112335faa0              31109
##  5 49f0bad299687c62334182178bfd75d8               3670
##  6 a4f0dc8026624beec687c6b74e5adc46               3333
##  7 a8f5f167f44f4964e6c998dee827110c               2172
##  8 adbf5a778175ee757c34d0eba4e932bc               5351
##  9 b5b037a78522671b89a2c1b21d9b80c6              26866
## 10 bff149a0b87f5b0e00d9dd364e9ddaa0               2498
## 11 db06e8e094e3b4b5943bbb71aabe9cdc               3328</code></pre>
<p>Joining the <strong>conversionevents_unique</strong> dataframe with the <strong>campaigninfo</strong> dataframe in a dataframe named <strong>master</strong></p>
<pre class="r"><code>master&lt;-full_join(conversionevents_unique,campaingnsinfo,by=&quot;CAMPAIGNID&quot;)
master</code></pre>
<pre><code>## # A tibble: 114,710 x 5
##    Date       ID                  CAMPAIGNID         PAYOUT ACCOUNT_MANAGER
##    &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;          
##  1 2019-03-01 5f6e57a887303a5f56… 39060730d62be825e…   9    Felix Butterwo…
##  2 2019-03-01 c4c6e95e34c3bfe9d8… 39060730d62be825e…   9    Felix Butterwo…
##  3 2019-03-01 b645996f754e084f5d… b5b037a78522671b8…   7.6  Erica Archer   
##  4 2019-03-01 e3527595bb5f0c3dee… 39060730d62be825e…   9    Felix Butterwo…
##  5 2019-03-01 6bda4fea92cf931050… db06e8e094e3b4b59…   0.9  Erica Archer   
##  6 2019-03-01 4bbf1c577a6ae45c5f… 39060730d62be825e…   9    Felix Butterwo…
##  7 2019-03-01 9a1519e497fe9aabe0… 396ac2a33748bb784…   3.76 John Smith     
##  8 2019-03-01 8e15e2b783986d0054… 1395ad342f7331f6a…   8.1  Felix Butterwo…
##  9 2019-03-01 99f8175f367caeb713… 2b7203e1d1b1c3dd4…  10    John Smith     
## 10 2019-03-01 3a9b8971c8a7294c66… b5b037a78522671b8…   7.6  Erica Archer   
## # … with 114,700 more rows</code></pre>
<p>calculating spend per campaign</p>
<pre class="r"><code>master2&lt;-master%&gt;% group_by(CAMPAIGNID,PAYOUT,ACCOUNT_MANAGER) %&gt;%summarise( CAMPAIGN_CONVERSION = n())%&gt;% mutate(TOTALSPEND=(PAYOUT*CAMPAIGN_CONVERSION))
knitr::kable(master2,n=11)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">CAMPAIGNID</th>
<th align="right">PAYOUT</th>
<th align="left">ACCOUNT_MANAGER</th>
<th align="right">CAMPAIGN_CONVERSION</th>
<th align="right">TOTALSPEND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1395ad342f7331f6ae81badb2eeb4717</td>
<td align="right">8.10</td>
<td align="left">Felix Butterworth</td>
<td align="right">1912</td>
<td align="right">15487.20</td>
</tr>
<tr class="even">
<td align="left">2b7203e1d1b1c3dd4615bdd0ffe60736</td>
<td align="right">10.00</td>
<td align="left">John Smith</td>
<td align="right">17598</td>
<td align="right">175980.00</td>
</tr>
<tr class="odd">
<td align="left">39060730d62be825ebb599711124309a</td>
<td align="right">9.00</td>
<td align="left">Felix Butterworth</td>
<td align="right">16873</td>
<td align="right">151857.00</td>
</tr>
<tr class="even">
<td align="left">396ac2a33748bb784077f4112335faa0</td>
<td align="right">3.76</td>
<td align="left">John Smith</td>
<td align="right">31109</td>
<td align="right">116969.84</td>
</tr>
<tr class="odd">
<td align="left">49f0bad299687c62334182178bfd75d8</td>
<td align="right">5.30</td>
<td align="left">Erica Archer</td>
<td align="right">3670</td>
<td align="right">19451.00</td>
</tr>
<tr class="even">
<td align="left">a4f0dc8026624beec687c6b74e5adc46</td>
<td align="right">7.00</td>
<td align="left">Erica Archer</td>
<td align="right">3333</td>
<td align="right">23331.00</td>
</tr>
<tr class="odd">
<td align="left">a8f5f167f44f4964e6c998dee827110c</td>
<td align="right">0.45</td>
<td align="left">John Smith</td>
<td align="right">2172</td>
<td align="right">977.40</td>
</tr>
<tr class="even">
<td align="left">adbf5a778175ee757c34d0eba4e932bc</td>
<td align="right">3.10</td>
<td align="left">Felix Butterworth</td>
<td align="right">5351</td>
<td align="right">16588.10</td>
</tr>
<tr class="odd">
<td align="left">b5b037a78522671b89a2c1b21d9b80c6</td>
<td align="right">7.60</td>
<td align="left">Erica Archer</td>
<td align="right">26866</td>
<td align="right">204181.60</td>
</tr>
<tr class="even">
<td align="left">bff149a0b87f5b0e00d9dd364e9ddaa0</td>
<td align="right">4.87</td>
<td align="left">Felix Butterworth</td>
<td align="right">2498</td>
<td align="right">12165.26</td>
</tr>
<tr class="odd">
<td align="left">db06e8e094e3b4b5943bbb71aabe9cdc</td>
<td align="right">0.90</td>
<td align="left">Erica Archer</td>
<td align="right">3328</td>
<td align="right">2995.20</td>
</tr>
</tbody>
</table>
<p>Selecting the column needed for Task1 Report</p>
<pre class="r"><code>Task1&lt;-master2%&gt;%ungroup()%&gt;%select(CAMPAIGNID,ACCOUNT_MANAGER,CAMPAIGN_CONVERSION,PAYOUT,TOTALSPEND)
knitr::kable(Task1, n=11)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">CAMPAIGNID</th>
<th align="left">ACCOUNT_MANAGER</th>
<th align="right">CAMPAIGN_CONVERSION</th>
<th align="right">PAYOUT</th>
<th align="right">TOTALSPEND</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1395ad342f7331f6ae81badb2eeb4717</td>
<td align="left">Felix Butterworth</td>
<td align="right">1912</td>
<td align="right">8.10</td>
<td align="right">15487.20</td>
</tr>
<tr class="even">
<td align="left">2b7203e1d1b1c3dd4615bdd0ffe60736</td>
<td align="left">John Smith</td>
<td align="right">17598</td>
<td align="right">10.00</td>
<td align="right">175980.00</td>
</tr>
<tr class="odd">
<td align="left">39060730d62be825ebb599711124309a</td>
<td align="left">Felix Butterworth</td>
<td align="right">16873</td>
<td align="right">9.00</td>
<td align="right">151857.00</td>
</tr>
<tr class="even">
<td align="left">396ac2a33748bb784077f4112335faa0</td>
<td align="left">John Smith</td>
<td align="right">31109</td>
<td align="right">3.76</td>
<td align="right">116969.84</td>
</tr>
<tr class="odd">
<td align="left">49f0bad299687c62334182178bfd75d8</td>
<td align="left">Erica Archer</td>
<td align="right">3670</td>
<td align="right">5.30</td>
<td align="right">19451.00</td>
</tr>
<tr class="even">
<td align="left">a4f0dc8026624beec687c6b74e5adc46</td>
<td align="left">Erica Archer</td>
<td align="right">3333</td>
<td align="right">7.00</td>
<td align="right">23331.00</td>
</tr>
<tr class="odd">
<td align="left">a8f5f167f44f4964e6c998dee827110c</td>
<td align="left">John Smith</td>
<td align="right">2172</td>
<td align="right">0.45</td>
<td align="right">977.40</td>
</tr>
<tr class="even">
<td align="left">adbf5a778175ee757c34d0eba4e932bc</td>
<td align="left">Felix Butterworth</td>
<td align="right">5351</td>
<td align="right">3.10</td>
<td align="right">16588.10</td>
</tr>
<tr class="odd">
<td align="left">b5b037a78522671b89a2c1b21d9b80c6</td>
<td align="left">Erica Archer</td>
<td align="right">26866</td>
<td align="right">7.60</td>
<td align="right">204181.60</td>
</tr>
<tr class="even">
<td align="left">bff149a0b87f5b0e00d9dd364e9ddaa0</td>
<td align="left">Felix Butterworth</td>
<td align="right">2498</td>
<td align="right">4.87</td>
<td align="right">12165.26</td>
</tr>
<tr class="odd">
<td align="left">db06e8e094e3b4b5943bbb71aabe9cdc</td>
<td align="left">Erica Archer</td>
<td align="right">3328</td>
<td align="right">0.90</td>
<td align="right">2995.20</td>
</tr>
</tbody>
</table>
<p>calculating daily spend per campaign</p>
<pre class="r"><code>master3&lt;-master%&gt;% group_by(CAMPAIGNID,Date,PAYOUT) %&gt;%summarise( CAMPAIGN_CONVERSION = n())%&gt;% mutate(TOTALSPEND=(PAYOUT*CAMPAIGN_CONVERSION))
master3</code></pre>
<pre><code>## # A tibble: 75 x 5
## # Groups:   CAMPAIGNID, Date [75]
##    CAMPAIGNID                Date       PAYOUT CAMPAIGN_CONVERS… TOTALSPEND
##    &lt;chr&gt;                     &lt;date&gt;      &lt;dbl&gt;             &lt;int&gt;      &lt;dbl&gt;
##  1 1395ad342f7331f6ae81badb… 2019-03-01    8.1               211      1709.
##  2 1395ad342f7331f6ae81badb… 2019-03-02    8.1               482      3904.
##  3 1395ad342f7331f6ae81badb… 2019-03-03    8.1               568      4601.
##  4 1395ad342f7331f6ae81badb… 2019-03-04    8.1               289      2341.
##  5 1395ad342f7331f6ae81badb… 2019-03-05    8.1               148      1199.
##  6 1395ad342f7331f6ae81badb… 2019-03-06    8.1                18       146.
##  7 1395ad342f7331f6ae81badb… 2019-03-07    8.1               196      1588.
##  8 2b7203e1d1b1c3dd4615bdd0… 2019-03-01   10                 970      9700 
##  9 2b7203e1d1b1c3dd4615bdd0… 2019-03-02   10                1182     11820 
## 10 2b7203e1d1b1c3dd4615bdd0… 2019-03-03   10                8998     89980 
## # … with 65 more rows</code></pre>
<p>calculating daily percentage differences per campaign</p>
<pre class="r"><code>library(scales)
dailydiff&lt;-master3%&gt;%ungroup()%&gt;%select(Date,CAMPAIGNID,TOTALSPEND)%&gt;%group_by(CAMPAIGNID,Date)%&gt;%summarise(TOTALSPEND = sum(TOTALSPEND))%&gt;% mutate(DIFF=TOTALSPEND-lag(TOTALSPEND, n=1),PERCENT_DIFF = percent(DIFF/lag(TOTALSPEND,n=1)))
dailydiff</code></pre>
<pre><code>## # A tibble: 75 x 5
## # Groups:   CAMPAIGNID [11]
##    CAMPAIGNID                     Date       TOTALSPEND   DIFF PERCENT_DIFF
##    &lt;chr&gt;                          &lt;date&gt;          &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       
##  1 1395ad342f7331f6ae81badb2eeb4… 2019-03-01      1709.    NA  NA%         
##  2 1395ad342f7331f6ae81badb2eeb4… 2019-03-02      3904.  2195. 130%        
##  3 1395ad342f7331f6ae81badb2eeb4… 2019-03-03      4601.   697. 20%         
##  4 1395ad342f7331f6ae81badb2eeb4… 2019-03-04      2341. -2260. -50%        
##  5 1395ad342f7331f6ae81badb2eeb4… 2019-03-05      1199. -1142. -50%        
##  6 1395ad342f7331f6ae81badb2eeb4… 2019-03-06       146. -1053  -90%        
##  7 1395ad342f7331f6ae81badb2eeb4… 2019-03-07      1588.  1442. 990%        
##  8 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-01      9700     NA  NA%         
##  9 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-02     11820   2120  22%         
## 10 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-03     89980  78160  661%        
## # … with 65 more rows</code></pre>
<p>Selecting the column needed for Task2 Report</p>
<pre class="r"><code>Task2&lt;-dailydiff%&gt;%ungroup()
Task2</code></pre>
<pre><code>## # A tibble: 75 x 5
##    CAMPAIGNID                     Date       TOTALSPEND   DIFF PERCENT_DIFF
##    &lt;chr&gt;                          &lt;date&gt;          &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       
##  1 1395ad342f7331f6ae81badb2eeb4… 2019-03-01      1709.    NA  NA%         
##  2 1395ad342f7331f6ae81badb2eeb4… 2019-03-02      3904.  2195. 130%        
##  3 1395ad342f7331f6ae81badb2eeb4… 2019-03-03      4601.   697. 20%         
##  4 1395ad342f7331f6ae81badb2eeb4… 2019-03-04      2341. -2260. -50%        
##  5 1395ad342f7331f6ae81badb2eeb4… 2019-03-05      1199. -1142. -50%        
##  6 1395ad342f7331f6ae81badb2eeb4… 2019-03-06       146. -1053  -90%        
##  7 1395ad342f7331f6ae81badb2eeb4… 2019-03-07      1588.  1442. 990%        
##  8 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-01      9700     NA  NA%         
##  9 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-02     11820   2120  22%         
## 10 2b7203e1d1b1c3dd4615bdd0ffe60… 2019-03-03     89980  78160  661%        
## # … with 65 more rows</code></pre>
<p>Exporting Task1 and Task2 Report in an xlsx file</p>
<pre class="r"><code>library(xlsx)

# create new workbook
wb &lt;- createWorkbook()

#--------------------
# DEFINE CELL STYLES 
#--------------------
# title and subtitle styles
title_style &lt;- CellStyle(wb) + 
               Font(wb, heightInPoints = 16,
                    color = &quot;blue&quot;, 
                    isBold = TRUE, 
                    underline = 1)

subtitle_style &lt;- CellStyle(wb) + 
                  Font(wb, heightInPoints = 14,
                       isItalic = TRUE,
                       isBold = FALSE)

# data table styles
rowname_style &lt;- CellStyle(wb) +
                 Font(wb, isBold = TRUE)

colname_style &lt;- CellStyle(wb) +
                 Font(wb, isBold = TRUE) +
                 Alignment(wrapText = TRUE, horizontal = &quot;ALIGN_CENTER&quot;) +
                 Border(color = &quot;black&quot;,
                        position = c(&quot;TOP&quot;, &quot;BOTTOM&quot;),
                        pen = c(&quot;BORDER_THIN&quot;, &quot;BORDER_THICK&quot;))



#-------------------------
# CREATE &amp; EDIT WORKSHEET 
#-------------------------
# create worksheets
sheet1 &lt;- createSheet(wb, sheetName = &quot;Task1&quot;)
sheet2 &lt;- createSheet(wb, sheetName = &quot;Task2&quot;)

# helper function to add titles
xlsx.addTitle &lt;- function(sheet, rowIndex, title, titleStyle) {
        rows &lt;- createRow(sheet, rowIndex = rowIndex)
        sheetTitle &lt;- createCell(rows, colIndex = 1)
        setCellValue(sheetTitle[[1,1]], title)
        setCellStyle(sheetTitle[[1,1]], titleStyle)
}

# add title and sub title to worksheet
xlsx.addTitle(sheet = sheet1, rowIndex = 1, 
              title = &quot;Advert&quot;,
              titleStyle = title_style)

xlsx.addTitle(sheet = sheet2, rowIndex = 1, 
              title = &quot;Advert&quot;,
              titleStyle = title_style)

xlsx.addTitle(sheet =sheet1, rowIndex = 2, 
              title = &quot;Total Spend per Campaign &amp; Account Manager&quot;,
              titleStyle = subtitle_style)

xlsx.addTitle(sheet =sheet2, rowIndex = 2, 
              title = &quot;Total Spend per Campaign &amp; Account Manager Declining Campaigns&quot;,titleStyle = subtitle_style)

# add data frame to worksheet
addDataFrame(Task1, sheet = sheet1, startRow = 3, startColumn = 1,
             colnamesStyle = colname_style, 
             rownamesStyle = rowname_style)

addDataFrame(Task2, sheet = sheet2, startRow = 3, startColumn = 1,
             colnamesStyle = colname_style, 
             rownamesStyle = rowname_style)

# change row name column width
setColumnWidth(sheet = sheet1, colIndex = 1, colWidth = 3)
setColumnWidth(sheet = sheet1, colIndex = 2, colWidth = 38)
setColumnWidth(sheet = sheet1, colIndex = 3, colWidth = 21)
setColumnWidth(sheet = sheet1, colIndex = 4, colWidth = 15)

# change row name column width
setColumnWidth(sheet = sheet2, colIndex = 1, colWidth = 3)
setColumnWidth(sheet = sheet2, colIndex = 2, colWidth = 38)
setColumnWidth(sheet = sheet2, colIndex = 3, colWidth = 25)
setColumnWidth(sheet = sheet2, colIndex = 4, colWidth = 30)


# save workbook
saveWorkbook(wb, file = &quot;AdvertReport.xlsx&quot;)

# view the file
#library(r2excel)
#in case you do not have r2excel package in  your library please run the following: 
#install.packages(&quot;devtools&quot;)
#devtools::install_github(&quot;kassambara/r2excel&quot;)
#xlsx.openFile(&quot;BlueBananaReport.xlsx&quot;)</code></pre>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
